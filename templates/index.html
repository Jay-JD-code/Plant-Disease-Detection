{% extends "base.html" %}

{% block title %}Upload Image - Plant Disease Detection{% endblock %}

{% block content %}
<div class="container my-5">
    <!-- Hero Section -->
    <div class="row justify-content-center">
        <div class="col-lg-10 text-center">
            <div class="hero-section">
                <i class="fas fa-seedling" style="font-size: 4rem;"></i>
                <h1 class="display-4 fw-bold mt-3">AI Plant Disease Detection</h1>
                <p class="lead">
                    Upload an image of a plant leaf to detect diseases using our advanced EfficientNet AI model
                </p>
                <div class="row justify-content-center mt-4">
                    <div class="col-md-4 text-center">
                        <div class="d-flex align-items-center justify-content-center">
                            <i class="fas fa-check-circle text-success me-2"></i>
                            <span class="fw-medium">23+ Plant Diseases</span>
                        </div>
                    </div>
                    <div class="col-md-4 text-center">
                        <div class="d-flex align-items-center justify-content-center">
                            <i class="fas fa-bolt text-warning me-2"></i>
                            <span class="fw-medium">Instant Results</span>
                        </div>
                    </div>
                    <div class="col-md-4 text-center">
                        <div class="d-flex align-items-center justify-content-center">
                            <i class="fas fa-shield-alt text-success me-2"></i>
                            <span class="fw-medium">AI Powered</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Section -->
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            <div class="card fade-in-scale">
                <div class="card-header text-center">
                    <h4 class="mb-0">
                        <i class="fas fa-cloud-upload-alt"></i>
                        Upload Plant Image for Analysis
                    </h4>
                </div>
                <div class="card-body p-4">
                    <form action="{{ url_for('predict') }}" method="post" enctype="multipart/form-data" id="uploadForm">
                        <!-- Drag & Drop Upload Area -->
                        <div class="upload-area" id="uploadArea">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <h5 class="mt-3 mb-2">Drag & drop your plant image here</h5>
                            <p class="text-muted mb-3">or click to browse files</p>
                            <input type="file" id="file" name="file" accept="image/*" required style="display: none;">
                            <button type="button" class="btn btn-outline-success" onclick="document.getElementById('file').click()">
                                <i class="fas fa-folder-open"></i> Choose File
                            </button>
                            <div class="mt-3 small text-muted">
                                <i class="fas fa-info-circle"></i>
                                Supported formats: JPG, PNG, GIF, BMP â€¢ Max size: 16MB
                            </div>
                        </div>
                        
                        <!-- Image Preview -->
                        <div id="imagePreview" class="text-center mt-4" style="display: none;">
                            <div class="image-preview">
                                <img id="previewImg" src="#" alt="Preview" class="img-fluid" style="max-height: 400px;">
                                <div class="mt-3">
                                    <span class="badge bg-success" id="fileName"></span>
                                    <button type="button" class="btn btn-sm btn-outline-danger ms-2" onclick="clearPreview()">
                                        <i class="fas fa-times"></i> Remove
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid mt-4">
                            <button type="submit" class="btn btn-success btn-lg" id="submitBtn" disabled>
                                <i class="fas fa-microscope"></i>
                                Analyze Plant Disease
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Features Section -->
    <div class="row mt-5">
        <div class="col-12">
            <h3 class="text-center mb-4">Key Features</h3>
        </div>
        <div class="col-md-4">
            <div class="card border-0 text-center h-100">
                <div class="card-body">
                    <i class="fas fa-brain text-primary" style="font-size: 3rem;"></i>
                    <h5 class="card-title mt-3">AI-Powered Detection</h5>
                    <p class="card-text">Advanced EfficientNet deep learning model trained for high accuracy</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 text-center h-100">
                <div class="card-body">
                    <i class="fas fa-lightning-bolt text-warning" style="font-size: 3rem;"></i>
                    <h5 class="card-title mt-3">Fast Results</h5>
                    <p class="card-text">Get instant predictions with confidence scores and top-3 alternatives</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card border-0 text-center h-100">
                <div class="card-body">
                    <i class="fas fa-shield-alt text-success" style="font-size: 3rem;"></i>
                    <h5 class="card-title mt-3">Comprehensive Coverage</h5>
                    <p class="card-text">Detects diseases across multiple plant species including background detection</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Instructions -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card bg-light border-0">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-info-circle text-info"></i>
                        How to Use
                    </h5>
                    <ol class="mb-0">
                        <li>Click "Choose Image File" and select a clear photo of a plant leaf</li>
                        <li>Ensure the image shows the leaf clearly with good lighting</li>
                        <li>Click "Analyze Plant Disease" to get AI-powered results</li>
                        <li>View the prediction results with confidence scores</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-body text-center py-4">
                <div class="spinner-border text-success" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <h5 class="mt-3">Analyzing Image...</h5>
                <p class="text-muted">Our AI is examining your plant image for diseases</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    const fileInput = document.getElementById('file');
    const uploadArea = document.getElementById('uploadArea');
    const imagePreview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');
    const fileName = document.getElementById('fileName');
    const submitBtn = document.getElementById('submitBtn');

    // Prevent default drag behaviors
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, preventDefaults, false);
        document.body.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    // Highlight drop area when item is dragged over it
    ['dragenter', 'dragover'].forEach(eventName => {
        uploadArea.addEventListener(eventName, highlight, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        uploadArea.addEventListener(eventName, unhighlight, false);
    });

    function highlight(e) {
        uploadArea.classList.add('dragover');
    }

    function unhighlight(e) {
        uploadArea.classList.remove('dragover');
    }

    // Handle dropped files
    uploadArea.addEventListener('drop', handleDrop, false);

    function handleDrop(e) {
        const dt = e.dataTransfer;
        const files = dt.files;
        if (files.length > 0) {
            // Create a new FileList-like object and assign it
            const dataTransfer = new DataTransfer();
            dataTransfer.items.add(files[0]);
            fileInput.files = dataTransfer.files;
            handleFile(files[0]);
        }
    }

    // Handle click on upload area
    uploadArea.addEventListener('click', function(e) {
        // Prevent if clicking on the button inside
        if (!e.target.closest('.btn')) {
            fileInput.click();
        }
    });

    // File input change event
    fileInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            handleFile(file);
        }
    });

    function handleFile(file) {
        // Validate file type
        if (!file.type.startsWith('image/')) {
            alert('Please select an image file.');
            return;
        }

        // Validate file size (16MB)
        if (file.size > 16 * 1024 * 1024) {
            alert('File size must be less than 16MB.');
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            previewImg.src = e.target.result;
            fileName.textContent = file.name;
            imagePreview.style.display = 'block';
            submitBtn.disabled = false;
            uploadArea.style.display = 'none';
        };
        reader.readAsDataURL(file);
    }

    function clearPreview() {
        imagePreview.style.display = 'none';
        uploadArea.style.display = 'block';
        fileInput.value = '';
        submitBtn.disabled = true;
    }

    // Show loading modal on form submit
    document.getElementById('uploadForm').addEventListener('submit', function(e) {
        if (!fileInput.files[0]) {
            e.preventDefault();
            alert('Please select an image file first.');
            return;
        }
        const modal = new bootstrap.Modal(document.getElementById('loadingModal'));
        modal.show();
    });

    // Add smooth animations
    document.addEventListener('DOMContentLoaded', function() {
        // Animate elements on page load
        const cards = document.querySelectorAll('.card');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            setTimeout(() => {
                card.style.transition = 'all 0.6s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 200);
        });
    });
</script>
{% endblock %}
